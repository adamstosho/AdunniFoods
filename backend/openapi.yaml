openapi: 3.0.3
info:
  title: Adunni Foods API
  description: |
    # Adunni Foods - Plantain Chips Ordering System
    
    A comprehensive REST API for managing plantain chips products, customer orders, and business operations.
    
    ## Features
    - **Product Management**: CRUD operations for plantain chips products
    - **Order Processing**: Customer order creation and management
    - **Admin Authentication**: Secure admin login system
    - **File Uploads**: Product image management via Cloudinary
    - **WhatsApp Integration**: Order notifications and communication
    - **Email Services**: Customer communication via SendGrid
    - **CSV Export**: Order data export functionality
    
    ## Authentication
    - JWT-based authentication for admin endpoints
    - Include `Authorization: Bearer <token>` header for protected routes
    
    ## Base URL
    - Development: `http://localhost:5000/api`
    - Production: `https://your-domain.com/api`
    
  version: 1.0.0
  contact:
    name: Adunni Foods Support
    email: adunnifoods8@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:5000/api
    description: Development server
  - url: https://api.adunnifoods.com/api
    description: Production server

tags:
  - name: Authentication
    description: Admin authentication operations
  - name: Products
    description: Product management operations
  - name: Orders
    description: Order processing and management
  - name: Uploads
    description: File upload operations
  - name: Admin
    description: Admin-only operations

paths:
  /:
    get:
      tags:
        - General
      summary: API Health Check
      description: Returns basic API information and status
      responses:
        '200':
          description: API is running successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Adunni Foods API"
                  status:
                    type: string
                    example: "running"
                  timestamp:
                    type: string
                    format: date-time

  /auth/login:
    post:
      tags:
        - Authentication
      summary: Admin Login
      description: Authenticate admin user and receive JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              username: "admin"
              password: "your_password"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /auth/register:
    post:
      tags:
        - Authentication
      summary: Admin Registration
      description: Create a new admin user account
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              username: "newadmin"
              password: "securepassword123"
              confirmPassword: "securepassword123"
      responses:
        '201':
          description: Admin user created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RegisterResponse'
              example:
                message: "Admin user created successfully"
                response:
                  username: "newadmin"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '409':
          description: Username already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                message: "Admin user already exists with this username"

  /products:
    get:
      tags:
        - Products
      summary: List All Products
      description: Retrieve a list of all available plantain chips products
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of products per page
        - in: query
          name: search
          schema:
            type: string
          description: Search products by name or description
      responses:
        '200':
          description: List of products retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductListResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    post:
      tags:
        - Products
      summary: Create New Product
      description: Create a new plantain chips product (Admin only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateProductRequest'
            example:
              name: "Spicy Plantain Chips"
              slug: "spicy-plantain-chips"
              description: "Delicious spicy plantain chips with a kick"
              price: 15.99
              stock: 100
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Unauthorized - Invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Product with this slug already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{id}:
    get:
      tags:
        - Products
      summary: Get Product by ID
      description: Retrieve a specific product by its ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
          description: Product ID (MongoDB ObjectId)
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    
    put:
      tags:
        - Products
      summary: Update Product
      description: Update an existing product (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
          description: Product ID (MongoDB ObjectId)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateProductRequest'
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Unauthorized - Invalid or missing token
        '404':
          description: Product not found
    
    delete:
      tags:
        - Products
      summary: Delete Product
      description: Delete a product (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
          description: Product ID (MongoDB ObjectId)
      responses:
        '204':
          description: Product deleted successfully
        '401':
          description: Unauthorized - Invalid or missing token
        '404':
          description: Product not found

  /orders:
    get:
      tags:
        - Orders
      summary: List All Orders
      description: Retrieve a list of all orders (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Number of orders per page
        - in: query
          name: status
          schema:
            type: string
            enum: [Pending, Packed, "Out for Delivery", Completed]
          description: Filter orders by status
        - in: query
          name: startDate
          schema:
            type: string
            format: date
          description: Filter orders from this date (YYYY-MM-DD)
        - in: query
          name: endDate
          schema:
            type: string
            format: date
          description: Filter orders until this date (YYYY-MM-DD)
      responses:
        '200':
          description: List of orders retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderListResponse'
        '401':
          description: Unauthorized - Invalid or missing token
    
    post:
      tags:
        - Orders
      summary: Create New Order
      description: Create a new customer order (Public endpoint)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            example:
              customerName: "John Doe"
              customerPhone: "2348144665646"
              address: "123 Main Street, Lagos, Nigeria"
              items:
                - product: "507f1f77bcf86cd799439011"
                  name: "Spicy Plantain Chips"
                  qty: 2
                  price: 15.99
              totalAmount: 31.98
              paymentMethod: "bank_transfer"
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateOrderResponse'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get Order by ID
      description: Retrieve a specific order by its ID (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
          description: Order ID (MongoDB ObjectId)
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '401':
          description: Unauthorized - Invalid or missing token
        '404':
          description: Order not found
    
    put:
      tags:
        - Orders
      summary: Update Order Status
      description: Update the status of an order (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
            pattern: '^[0-9a-fA-F]{24}$'
          description: Order ID (MongoDB ObjectId)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateOrderStatusRequest'
            example:
              status: "Packed"
      responses:
        '200':
          description: Order status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Validation error
        '401':
          description: Unauthorized - Invalid or missing token
        '404':
          description: Order not found

  /orders/export/csv:
    get:
      tags:
        - Orders
      summary: Export Orders as CSV
      description: Export all orders to CSV format (Admin only)
      security:
        - BearerAuth: []
      parameters:
        - in: query
          name: startDate
          schema:
            type: string
            format: date
          description: Export orders from this date (YYYY-MM-DD)
        - in: query
          name: endDate
          schema:
            type: string
            format: date
          description: Export orders until this date (YYYY-MM-DD)
        - in: query
          name: status
          schema:
            type: string
            enum: [Pending, Packed, "Out for Delivery", Completed]
          description: Filter orders by status for export
      responses:
        '200':
          description: CSV file generated successfully
          content:
            text/csv:
              schema:
                type: string
                format: binary
          headers:
            Content-Disposition:
              description: CSV file download
              schema:
                type: string
                example: "attachment; filename=orders-2024-01-01.csv"
        '401':
          description: Unauthorized - Invalid or missing token

  /upload:
    post:
      tags:
        - Uploads
      summary: Upload Product Image
      description: Upload an image for a product (Admin only)
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file to upload (JPG, PNG, WebP)
            required:
              - file
      responses:
        '200':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UploadResponse'
        '400':
          description: No file provided or invalid file type
        '401':
          description: Unauthorized - Invalid or missing token
        '413':
          description: File too large (max 5MB)

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login

  schemas:
    # Authentication Schemas
    LoginRequest:
      type: object
      required:
        - username
        - password
      properties:
        username:
          type: string
          minLength: 1
          description: Admin username
          example: "admin"
        password:
          type: string
          minLength: 6
          description: Admin password
          example: "secure_password"
    
    LoginResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Login successful"
        token:
          type: string
          description: JWT token for authentication
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        admin:
          type: object
          properties:
            id:
              type: string
              example: "507f1f77bcf86cd799439011"
            username:
              type: string
              example: "admin"
            createdAt:
              type: string
              format: date-time
              example: "2024-01-01T00:00:00.000Z"

    RegisterRequest:
      type: object
      required:
        - username
        - password
        - confirmPassword
      properties:
        username:
          type: string
          minLength: 3
          maxLength: 30
          pattern: '^[a-zA-Z0-9_]+$'
          description: Admin username (letters, numbers, underscores only)
          example: "newadmin"
        password:
          type: string
          minLength: 8
          description: Admin password (minimum 8 characters)
          example: "securepassword123"
        confirmPassword:
          type: string
          minLength: 1
          description: Password confirmation
          example: "securepassword123"
    
    RegisterResponse:
      type: object
      properties:
        message:
          type: string
          example: "Admin user created successfully"
        response:
          type: object
          properties:
            username:
              type: string
              example: "newadmin"

    # Product Schemas
    CreateProductRequest:
      type: object
      required:
        - name
        - slug
        - price
      properties:
        name:
          type: string
          minLength: 1
          description: Product name
          example: "Spicy Plantain Chips"
        slug:
          type: string
          minLength: 1
          description: URL-friendly product identifier
          example: "spicy-plantain-chips"
        description:
          type: string
          description: Product description
          example: "Delicious spicy plantain chips with a kick"
        price:
          type: number
          minimum: 0
          description: Product price in local currency
          example: 15.99
        stock:
          type: integer
          minimum: 0
          default: 0
          description: Available stock quantity
          example: 100
        images:
          type: array
          items:
            type: string
            format: uri
          description: Array of product image URLs
          example: ["https://res.cloudinary.com/djqfvpvsx/image/upload/v1/products/spicy-chips.jpg"]

    UpdateProductRequest:
      allOf:
        - $ref: '#/components/schemas/CreateProductRequest'
        - type: object
          description: All fields are optional for updates

    ProductResponse:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          example: "Spicy Plantain Chips"
        slug:
          type: string
          example: "spicy-plantain-chips"
        description:
          type: string
          example: "Delicious spicy plantain chips with a kick"
        price:
          type: number
          example: 15.99
        stock:
          type: integer
          example: 100
        images:
          type: array
          items:
            type: string
            format: uri
          example: ["https://res.cloudinary.com/djqfvpvsx/image/upload/v1/products/spicy-chips.jpg"]
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"

    ProductListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/ProductResponse'
        pagination:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 20
            total:
              type: integer
              example: 50
            pages:
              type: integer
              example: 3

    # Order Schemas
    OrderItem:
      type: object
      required:
        - product
        - name
        - qty
        - price
      properties:
        product:
          type: string
          description: Product ID reference
          example: "507f1f77bcf86cd799439011"
        name:
          type: string
          description: Product name
          example: "Spicy Plantain Chips"
        qty:
          type: integer
          minimum: 1
          description: Quantity ordered
          example: 2
        price:
          type: number
          minimum: 0
          description: Unit price
          example: 15.99

    CreateOrderRequest:
      type: object
      required:
        - customerName
        - customerPhone
        - address
        - items
        - totalAmount
        - paymentMethod
      properties:
        customerName:
          type: string
          minLength: 1
          description: Customer's full name
          example: "John Doe"
        customerPhone:
          type: string
          minLength: 6
          description: Customer's phone number
          example: "2348144665646"
        address:
          type: string
          minLength: 1
          description: Delivery address
          example: "123 Main Street, Lagos, Nigeria"
        items:
          type: array
          minItems: 1
          items:
            $ref: '#/components/schemas/OrderItem'
          description: Array of ordered items
        totalAmount:
          type: number
          minimum: 0
          description: Total order amount
          example: 31.98
        paymentMethod:
          type: string
          enum: [bank_transfer, mobile_money, cash_on_delivery]
          description: Payment method
          example: "bank_transfer"

    UpdateOrderStatusRequest:
      type: object
      required:
        - status
      properties:
        status:
          type: string
          enum: [Pending, Packed, "Out for Delivery", Completed]
          description: New order status
          example: "Packed"

    OrderResponse:
      type: object
      properties:
        _id:
          type: string
          example: "507f1f77bcf86cd799439011"
        customerName:
          type: string
          example: "John Doe"
        customerPhone:
          type: string
          example: "2348144665646"
        address:
          type: string
          example: "123 Main Street, Lagos, Nigeria"
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
        totalAmount:
          type: number
          example: 31.98
        paymentMethod:
          type: string
          enum: [bank_transfer, mobile_money, cash_on_delivery]
          example: "bank_transfer"
        status:
          type: string
          enum: [Pending, Packed, "Out for Delivery", Completed]
          example: "Pending"
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"

    CreateOrderResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Order created successfully"
        data:
          $ref: '#/components/schemas/OrderResponse'
        whatsappUrl:
          type: string
          format: uri
          description: WhatsApp URL for order confirmation
          example: "https://wa.me/2348144665646?text=Order%20confirmed%20for%20John%20Doe"

    OrderListResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        data:
          type: array
          items:
            $ref: '#/components/schemas/OrderResponse'
        pagination:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 20
            total:
              type: integer
              example: 25
            pages:
              type: integer
              example: 2

    # Upload Schemas
    UploadResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Image uploaded successfully"
        data:
          type: object
          properties:
            url:
              type: string
              format: uri
              description: Cloudinary image URL
              example: "https://res.cloudinary.com/djqfvpvsx/image/upload/v1/products/image123.jpg"
            publicId:
              type: string
              description: Cloudinary public ID
              example: "products/image123"
            format:
              type: string
              example: "jpg"
            size:
              type: integer
              description: File size in bytes
              example: 1024000

    # Error Schemas
    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          description: Error message
          example: "Product not found"
        error:
          type: string
          description: Error type
          example: "NotFoundError"

    ValidationError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Validation failed"
        errors:
          type: array
          items:
            type: object
            properties:
              field:
                type: string
                description: Field name with error
                example: "price"
              message:
                type: string
                description: Validation error message
                example: "Price must be a positive number"

# Security
security:
  - BearerAuth: []


